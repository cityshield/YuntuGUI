name: ðŸªŸ Simple MSVC Build (No Compiler Check)

on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ]

jobs:
  build-simple-msvc:
    runs-on: windows-2022
    
    steps:
    - name: ðŸ“¥ Checkout Code
      uses: actions/checkout@v4
    
    - name: ðŸ”§ Setup Visual Studio 2022
      uses: microsoft/setup-msbuild@v1.3
      with:
        vs-version: '17.0'
    
    - name: ðŸ“¦ Install Qt 6.5.3
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.5.3'
        host: windows
        target: desktop
        arch: win64_msvc2019_64
        modules: ''
        cache: true
    
    - name: ðŸ”§ Install CMake
      uses: jwlawson/actions-setup-cmake@v1.14
      with:
        cmake-version: '3.21.0'
    
    - name: ðŸ” Simple Environment Check
      run: |
        echo "=== ç®€å•çŽ¯å¢ƒæ£€æŸ¥ ==="
        echo "Qt è·¯å¾„: $env:Qt6_DIR"
        echo "CMake ç‰ˆæœ¬:"
        cmake --version
        echo "qmake ç‰ˆæœ¬:"
        qmake --version
        echo "âœ… çŽ¯å¢ƒæ£€æŸ¥å®Œæˆï¼Œè·³è¿‡ç¼–è¯‘å™¨æ£€æŸ¥"
    
    - name: ðŸ“ Create Build Directory
      run: mkdir build
    
    - name: âš™ï¸ Configure CMake (Simple)
      run: |
        cd build
        echo "=== é…ç½® CMake (ç®€å•æ¨¡å¼) ==="
        echo "Qt è·¯å¾„: $env:Qt6_DIR"
        
        # ä½¿ç”¨ç®€å•çš„ CMake é…ç½®ï¼Œè®© CMake è‡ªåŠ¨æ‰¾åˆ°ç¼–è¯‘å™¨
        cmake .. -G "Visual Studio 17 2022" -A x64 `
          -DCMAKE_BUILD_TYPE=Release `
          -DCMAKE_PREFIX_PATH="$env:Qt6_DIR" `
          -DQt6_DIR="$env:Qt6_DIR"
        
        echo "=== CMake é…ç½®å®Œæˆ ==="
    
    - name: ðŸ”¨ Build Application (Simple)
      run: |
        cd build
        echo "=== å¼€å§‹æž„å»º (ç®€å•æ¨¡å¼) ==="
        # ä½¿ç”¨ MSBuild ç›´æŽ¥æž„å»ºï¼Œé¿å…ç¼–è¯‘å™¨æ£€æŸ¥é—®é¢˜
        msbuild YuntuGUI.sln /p:Configuration=Release /p:Platform=x64 /verbosity:normal
        echo "=== æž„å»ºå®Œæˆ ==="
    
    - name: ðŸ” Check Build Result
      run: |
        echo "=== æ£€æŸ¥æž„å»ºç»“æžœ ==="
        if (Test-Path "build/Release/YuntuGUI.exe") {
          echo "âœ… æž„å»ºæˆåŠŸï¼æ‰¾åˆ° YuntuGUI.exe"
          $size = (Get-Item "build/Release/YuntuGUI.exe").Length
          echo "ðŸ“Š æ–‡ä»¶å¤§å°: $([math]::Round($size / 1MB, 2)) MB"
        } else {
          echo "âŒ æž„å»ºå¤±è´¥ï¼Œæ‰¾ä¸åˆ° YuntuGUI.exe"
          echo "=== æž„å»ºç›®å½•å†…å®¹ ==="
          Get-ChildItem -Recurse build/ | Select-Object Name, Length
          echo "=== Release ç›®å½•å†…å®¹ ==="
          if (Test-Path "build/Release") {
            Get-ChildItem build/Release/ | Select-Object Name, Length
          } else {
            echo "Release ç›®å½•ä¸å­˜åœ¨"
          }
        }
    
    - name: ðŸ“¦ Package Application
      run: |
        if (Test-Path "build/Release/YuntuGUI.exe") {
          echo "=== æ‰“åŒ…åº”ç”¨ç¨‹åº ==="
          mkdir package
          Copy-Item "build/Release/YuntuGUI.exe" "package/"
          
          # åˆ›å»ºè¯´æ˜Žæ–‡ä»¶
          @"
          YuntuGUI - ç®€å• MSVC æž„å»º
          
          æž„å»ºæ—¶é—´: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
          æäº¤: $env:GITHUB_SHA
          ç¼–è¯‘å™¨: MSVC 2022 (è‡ªåŠ¨æ£€æµ‹)
          Qt ç‰ˆæœ¬: 6.5.3
          
          è¿è¡Œè¯´æ˜Ž:
          1. åŒå‡» YuntuGUI.exe å¯åŠ¨ç¨‹åº
          2. å¦‚æžœæç¤ºç¼ºå°‘ DLLï¼Œè¯·å®‰è£… Visual C++ Redistributable
          
          ç³»ç»Ÿè¦æ±‚:
          - Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬
          - Visual C++ Redistributable 2019-2022
          "@ > "package/README.txt"
          
          # æ‰“åŒ…
          Compress-Archive -Path "package/*" -DestinationPath "YuntuGUI-Simple-MSVC.zip"
          echo "âœ… æ‰“åŒ…å®Œæˆ: YuntuGUI-Simple-MSVC.zip"
        } else {
          echo "âŒ æž„å»ºå¤±è´¥ï¼Œæ— æ³•æ‰“åŒ…"
          exit 1
        }
    
    - name: ðŸ“¤ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: YuntuGUI-Simple-MSVC
        path: YuntuGUI-Simple-MSVC.zip
        retention-days: 7
    
    - name: ðŸ“‹ Build Report
      if: always()
      run: |
        echo "## ðŸŽ¯ ç®€å• MSVC æž„å»ºæŠ¥å‘Š" >> $env:GITHUB_STEP_SUMMARY
        echo "" >> $env:GITHUB_STEP_SUMMARY
        
        if (Test-Path "build/Release/YuntuGUI.exe") {
          echo "âœ… **ç®€å• MSVC æž„å»ºæˆåŠŸ**" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "ðŸŽ‰ **YuntuGUI ç®€å• MSVC ç‰ˆæœ¬æž„å»ºå®Œæˆï¼**" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "ðŸ“¦ **ä¸‹è½½**: åœ¨ Artifacts ä¸­ä¸‹è½½ YuntuGUI-Simple-MSVC.zip" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "ðŸ”§ **æž„å»ºç‰¹ç‚¹**: è·³è¿‡ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œä½¿ç”¨ MSBuild ç›´æŽ¥æž„å»º" >> $env:GITHUB_STEP_SUMMARY
        } else {
          echo "âŒ **ç®€å• MSVC æž„å»ºå¤±è´¥**" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "è¯·æ£€æŸ¥æž„å»ºæ—¥å¿—èŽ·å–è¯¦ç»†ä¿¡æ¯ã€‚" >> $env:GITHUB_STEP_SUMMARY
        }
        
        echo "" >> $env:GITHUB_STEP_SUMMARY
        echo "### ðŸ”§ ç®€å• MSVC æž„å»ºé…ç½®" >> $env:GITHUB_STEP_SUMMARY
        echo "- ç¼–è¯‘å™¨: MSVC 2022 (è‡ªåŠ¨æ£€æµ‹ï¼Œæ— æ‰‹åŠ¨æ£€æŸ¥)" >> $env:GITHUB_STEP_SUMMARY
        echo "- æž„å»ºå·¥å…·: MSBuild (ç›´æŽ¥è°ƒç”¨)" >> $env:GITHUB_STEP_SUMMARY
        echo "- Qt: 6.5.3" >> $env:GITHUB_STEP_SUMMARY
        echo "- CMake: 3.21.0" >> $env:GITHUB_STEP_SUMMARY
        echo "- å¹³å°: Windows x64" >> $env:GITHUB_STEP_SUMMARY
